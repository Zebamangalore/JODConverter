<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Family JOD to INR Converter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; background: #f9f9f9; }
    h2 { color: #2c3e50; }
    table { margin: 20px auto; border-collapse: collapse; width: 90%; max-width: 720px; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #3498db; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
    .total-row { font-weight: bold; background: #27ae60; color: white; }
    input[type=number], select { padding: 6px; text-align: center; }
    button { margin: 10px; padding: 10px 20px; background: #3498db; color: white; border: none; cursor: pointer; border-radius: 5px; }
    button:hover { background: #2980b9; }
    #rateInfo, #lastUpdated { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>
    Family JOD to INR Converter  
    <select id="startMonth">
      <option>January</option><option>February</option><option>March</option><option>April</option>
      <option>May</option><option>June</option><option>July</option><option>August</option>
      <option>September</option><option>October</option><option>November</option><option>December</option>
    </select>
    to
    <select id="endMonth">
      <option>January</option><option>February</option><option>March</option><option>April</option>
      <option>May</option><option>June</option><option>July</option><option>August</option>
      <option>September</option><option>October</option><option>November</option><option>December</option>
    </select>
    <input type="number" id="yearBox" value="2026" style="width:80px;">
  </h2>

  <p>
    Manual override (optional):  
    <input type="number" id="manualRate" placeholder="Enter INR per JOD" step="0.01">
  </p>

  <table>
    <tr>
      <th>Person</th><th>Input</th><th>JOD (×7)</th><th>INR</th>
    </tr>
    <tr><td>Person 1</td><td><input type="number" id="p1"></td><td id="jod1">-</td><td id="inr1">-</td></tr>
    <tr><td>Person 2</td><td><input type="number" id="p2"></td><td id="jod2">-</td><td id="inr2">-</td></tr>
    <tr><td>Person 3</td><td><input type="number" id="p3"></td><td id="jod3">-</td><td id="inr3">-</td></tr>
    <tr><td>Person 4</td><td><input type="number" id="p4"></td><td id="jod4">-</td><td id="inr4">-</td></tr>
    <tr class="total-row"><td>Total</td><td id="totalInput">0</td><td id="totalJOD">0 JOD</td><td id="totalINR">₹0</td></tr>
  </table>

  <button onclick="convert()">Convert</button>
  <p id="rateInfo">Fetching live rate...</p>
  <p id="lastUpdated"></p>

  <script>
    let liveRate = null;

    window.onload = function() {
      // Format current date as dd-mm-yyyy
      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const year = now.getFullYear();
      const formattedDate = `${day}-${month}-${year}`;

      // Get selected range
      const start = document.getElementById("startMonth").value;
      const end = document.getElementById("endMonth").value;
      const yearBox = document.getElementById("yearBox").value;

      // Popup alert with selected range and current date
      alert("Welcome! Range: " + start + " to " + end + " " + yearBox +
            "\nCalculation date: " + formattedDate);

      // Fetch live JOD→INR rate if manual override empty
      const manualRate = document.getElementById("manualRate").value;
      if (!manualRate) {
        fetch("https://api.exchangerate.host/latest?base=JOD&symbols=INR")
          .then(response => response.json())
          .then(data => {
            liveRate = data.rates.INR;
            document.getElementById("rateInfo").innerHTML =
              "Live Rate: 1 JOD = ₹" + liveRate.toFixed(2);

            const updatedTime = new Date();
            document.getElementById("lastUpdated").innerHTML =
              "Last updated: " + updatedTime.toLocaleString();
          })
          .catch(err => {
            document.getElementById("rateInfo").innerHTML =
              "⚠️ Error fetching live rate.";
          });
      } else {
        liveRate = parseFloat(manualRate);
        document.getElementById("rateInfo").innerHTML =
          "Manual Rate: 1 JOD = ₹" + liveRate.toFixed(2);
      }
    };

    function convert() {
      // Always check manual override first
      const manualRate = document.getElementById("manualRate").value;
      if (manualRate) {
        liveRate = parseFloat(manualRate);
        document.getElementById("rateInfo").innerHTML =
          "Manual Rate: 1 JOD = ₹" + liveRate.toFixed(2);
      }

      if (!liveRate) {
        document.getElementById("rateInfo").innerHTML = "⚠️ Rate not available yet.";
        return;
      }

      let values = [
        Number(document.getElementById("p1").value),
        Number(document.getElementById("p2").value),
        Number(document.getElementById("p3").value),
        Number(document.getElementById("p4").value)
      ];

      let totalInput = 0, totalJOD = 0, totalINR = 0;

      values.forEach((val, i) => {
        let jod = val * 7;
        let inr = jod * liveRate;
        totalInput += val;
        totalJOD += jod;
        totalINR += inr;
        document.getElementById("jod" + (i+1)).innerHTML = jod + " JOD";
        document.getElementById("inr" + (i+1)).innerHTML = "₹" + inr.toFixed(2);
      });

      document.getElementById("totalInput").innerHTML = totalInput;
      document.getElementById("totalJOD").innerHTML = totalJOD + " JOD";
      document.getElementById("totalINR").innerHTML = "₹" + totalINR.toFixed(2);
    }
  </script>
</body>
</html>
